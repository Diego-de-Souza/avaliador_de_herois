<app-header></app-header>

<div id="checkout_container" class="container-fluid dark">
  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-12 col-lg-10">
        <h2 class="text-center mb-4">Finalizar Compra</h2>
        
        <div class="row">
          <!-- Formulário de checkout -->
          <div class="col-lg-8">
            <div class="card mb-4">
              <div class="card-header">
                <h5>Informações de Cobrança</h5>
              </div>
              <div class="card-body">
                <form [formGroup]="checkoutForm">
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label for="fullName" class="form-label">Nome Completo *</label>
                      <input 
                        type="text" 
                        class="form-control" 
                        id="fullName"
                        formControlName="fullName"
                        [class.is-invalid]="checkoutForm.get('fullName')?.invalid && checkoutForm.get('fullName')?.touched">
                    </div>
                    <div class="col-md-6 mb-3">
                      <label for="email" class="form-label">Email *</label>
                      <input 
                        type="email" 
                        class="form-control" 
                        id="email"
                        formControlName="email"
                        [class.is-invalid]="checkoutForm.get('email')?.invalid && checkoutForm.get('email')?.touched">
                    </div>
                  </div>
                  
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label for="cpf" class="form-label">CPF *</label>
                      <input 
                        type="text" 
                        class="form-control" 
                        id="cpf"
                        formControlName="cpf"
                        placeholder="000.000.000-00"
                        [class.is-invalid]="checkoutForm.get('cpf')?.invalid && checkoutForm.get('cpf')?.touched">
                    </div>
                    <div class="col-md-6 mb-3">
                      <label for="phone" class="form-label">Telefone *</label>
                      <input 
                        type="tel" 
                        class="form-control" 
                        id="phone"
                        formControlName="phone"
                        placeholder="(00) 00000-0000"
                        [class.is-invalid]="checkoutForm.get('phone')?.invalid && checkoutForm.get('phone')?.touched">
                    </div>
                  </div>
                </form>
              </div>
            </div>

            <!-- Informações de pagamento -->
            <div class="card">
              <div class="card-header">
                <h5>Informações de Pagamento</h5>
              </div>
              <div class="card-body">
                <div class="mb-3">
                  <label class="form-label">Cartão de Crédito *</label>
                  <div #cardElement class="form-control" style="padding: 12px;"></div>
                  <small class="text-muted">
                    Seus dados de pagamento são seguros e criptografados.
                  </small>
                </div>
                
                <div class="d-flex gap-2">
                  <button 
                    type="button" 
                    class="btn btn-outline-secondary"
                    (click)="goBackToCart()">
                    Voltar ao Carrinho
                  </button>
                  
                  <button 
                    type="button" 
                    class="btn btn-success btn-lg flex-grow-1"
                    [disabled]="!cardElementReady || loading || checkoutForm.invalid"
                    (click)="processPayment()">
                    <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
                    {{ loading ? 'Processando...' : 'Finalizar Pagamento' }}
                  </button>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Resumo do pedido -->
          <div class="col-lg-4">
            <div class="card">
              <div class="card-header">
                <h5>Resumo do Pedido</h5>
              </div>
              <div class="card-body">
                <div *ngFor="let item of cart.items" class="mb-3">
                  <div class="d-flex justify-content-between">
                    <div>
                      <h6 class="mb-1">{{ item.plan.name }}</h6>
                      <small class="text-muted">{{ item.plan.description }}</small>
                    </div>
                    <div class="text-end">
                      <strong>{{ formatPrice(item.plan.price) }}</strong>
                    </div>
                  </div>
                </div>
                
                <hr>
                
                <div class="d-flex justify-content-between mb-2">
                  <span>Subtotal:</span>
                  <span>{{ formatPrice(cart.total) }}</span>
                </div>
                
                <div class="d-flex justify-content-between">
                  <strong>Total:</strong>
                  <strong class="text-success">{{ formatPrice(cart.total) }}</strong>
                </div>
                
                <div class="mt-3">
                  <small class="text-muted">
                    <i class="fas fa-shield-alt"></i>
                    Pagamento 100% seguro com SSL
                  </small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<app-footer></app-footer>