<section class="newsletter-container">
  <app-header-platform></app-header-platform>
  <section class="cadastro-newsletter-container">
    <h1>{{ isEditMode ? 'Editar' : 'Cadastro de' }} Newsletter</h1>
    <form [formGroup]="newsletterForm" (ngSubmit)="onSubmit()">
      <div class="cadastro-newsletter-container__grid">
        <div class="form-group">
          <label for="title">Título</label>
          <input
            type="text"
            id="title"
            formControlName="title"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('title')"
          />
        </div>
        <div class="form-group">
          <label for="author">Autor</label>
          <input
            type="text"
            id="author"
            formControlName="author"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('author')"
          />
        </div>
        <div class="form-group">
          <label for="category">Categoria</label>
          <select 
              class="form-select" 
              id="category" 
              [formControl]="categoryControl"
              name="category">
              
              <option value="">Selecione uma categoria</option>
              @for (cat of categories; track cat.value) {
                <option [value]="cat.value">{{ cat.label }}</option>
              }
            </select>
        </div>
        <div class="form-group">
          <label for="date">Data</label>
          <input
            type="text"
            id="date"
            formControlName="date"
            class="form-control"
            placeholder="Ex: 25 Jan 2026"
            [class.is-invalid]="isFieldInvalid('date')"
          />
        </div>
        <div class="form-group">
          <label for="read_time">Tempo de leitura</label>
          <input
            type="text"
            id="read_time"
            formControlName="read_time"
            class="form-control"
            placeholder="Ex: 5 min"
            [class.is-invalid]="isFieldInvalid('read_time')"
          />
        </div>
        <div class="form-group">
          <label for="link">Link</label>
          <input
            type="url"
            id="link"
            formControlName="link"
            class="form-control"
            placeholder="https://..."
            [class.is-invalid]="isFieldInvalid('link')"
          />
        </div>
      </div>
      <div class="form-group">
        <label for="description">Descrição</label>
        <textarea
          id="description"
          formControlName="description"
          class="form-control"
          rows="4"
          [class.is-invalid]="isFieldInvalid('description')"
        ></textarea>
      </div>
      <div class="form-group">
        <label for="image">Imagem (JPG, PNG ou WebP, máx. 2MB)</label>
        <input
          type="file"
          id="image"
          accept="image/jpeg, image/jpg, image/png, image/webp"
          (change)="onImageSelected($event)"
          class="form-control"
        />
        @if (imagePreview || newsletterForm.get('image')?.value) {
          <div class="image-preview-wrapper">
            <img
              [src]="imagePreview || newsletterForm.get('image')?.value"
              alt="Preview"
              class="image-preview"
            />
            <button type="button" class="btn btn-remove-image" (click)="clearImage()">
              Remover imagem
            </button>
          </div>
        }
      </div>
      <div class="form-actions">
        <button type="submit" class="btn btn-primary" [disabled]="newsletterForm.invalid">
          {{ isEditMode ? 'Atualizar' : 'Salvar' }} Newsletter
        </button>
        <button type="button" class="btn btn-secondary" (click)="onCancel()">
          Cancelar
        </button>
      </div>
    </form>
  </section>
</section>
