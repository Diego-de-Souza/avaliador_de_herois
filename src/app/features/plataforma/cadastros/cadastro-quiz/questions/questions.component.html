<section class="questions-container-main">
    <app-header-platform style="width: 100%;"></app-header-platform>
    <section class="questions-container">
      <h2>Cadastro de Perguntas</h2>
      <div class="form-group">
        <label for="quizSelect">Selecione o Quiz</label>
        <select id="quizSelect" [(ngModel)]="selectedQuizId" (change)="onQuizSelect()" class="form-control">
          <option value="" disabled selected>Escolha um quiz</option>
          @for (quiz of quizzes; track quiz.id) {
            <option [value]="quiz.id">{{ quiz.name }}</option>
          }
        </select>
      </div>
      @if (levels.length > 0) {
        <div class="form-group">
          <label for="levelSelect">Selecione o Nível do Quiz</label>
          <select id="levelSelect" [(ngModel)]="selectedLevelId" (change)="onLevelSelect()" class="form-control">
            <option value="" disabled selected>Escolha um nível</option>
            @for (level of levels; track level.id) {
              <option [value]="level.id">{{ level.name }}</option>
            }
          </select>
        </div>
      }
    
      @if (showQuestionsModal) {
        <div class="modal-backdrop">
          <div class="modal-content">
            <h3>Pergunta {{ currentQuestionIndex + 1 }} de {{ questionsCount }}</h3>
            @if (currentQuestionGroup) {
              <form [formGroup]="currentQuestionGroup">
                <label>Pergunta</label>
                <input type="text" formControlName="question" class="form-control" placeholder="Digite a pergunta">
                <div class="mt-2">
                  <label>Opções de resposta:</label>
                  @for (opt of [0,1,2,3,4]; track opt) {
                    <input type="text"
                           [formControlName]="'option' + opt"
                           class="form-control mb-1"
                           placeholder="Opção {{ opt + 1 }}">
                  }
                </div>
                <div class="mt-2">
                  <label>Resposta correta:</label>
                  <select formControlName="answer" class="form-control">
                    @for (opt of [0,1,2,3,4]; track opt) {
                      <option [value]="currentQuestionGroup.get('option'+opt)?.value">
                        {{ currentQuestionGroup.get('option'+opt)?.value || ('Opção ' + (opt + 1)) }}
                      </option>
                    }
                  </select>
                </div>
              </form>
            }
            <div class="modal-actions mt-3">
              <button class="btn btn-secondary" (click)="previousQuestion()" [disabled]="currentQuestionIndex === 0">Anterior</button>
              <button class="btn btn-primary" (click)="nextQuestion()" [disabled]="currentQuestionIndex === questionsForm.length - 1">Próxima</button>
              @if (currentQuestionIndex === questionsForm.length - 1) {
                <button class="btn btn-success" (click)="saveQuestions()">Finalizar</button>
              }
              <button class="btn btn-danger" (click)="closeQuestionsModal()">Cancelar</button>
            </div>
          </div>
        </div>
      }
    </section>
</section>

@if (showModal) {
  <div class="modal fade show d-block" tabindex="-1" style="background:rgba(0,0,0,0.5);">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <app-modal-sucesso-cadastro
          [modalTitle]="modalTitle"
          [modalMessage]="modalMessage"
          (closeModalEvent)="closeModal()">
        </app-modal-sucesso-cadastro>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" (click)="closeModal()">Fechar</button>
        </div>
      </div>
    </div>
  </div>
}